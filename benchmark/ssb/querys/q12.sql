-- Q4.2

SELECT
    D_YEAR,
    S_NATION,
    P_CATEGORY,
    sum(LO_REVENUE - LO_SUPPLYCOST) AS profit
FROM
    date
JOIN
    lineorder ON LO_ORDERDATE = D_DATEKEY
JOIN
    customer ON LO_CUSTKEY = C_CUSTKEY
JOIN
    supplier ON LO_SUPPKEY = S_SUPPKEY
JOIN
    part ON LO_PARTKEY = P_PARTKEY
WHERE
    C_REGION = 'AMERICA'
    AND S_REGION = 'AMERICA'
    AND D_YEAR IN (1997, 1998)
    AND P_MFGR IN ('MFGR#1', 'MFGR#2')
GROUP BY
    D_YEAR,
    S_NATION,
    P_CATEGORY
ORDER BY
    D_YEAR,
    S_NATION,
    P_CATEGORY;
